<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>Euro-Truck-Simulator-2-Lane-Assist.main API documentation</title>
<meta name="description" content="The main file that runs the programs loop." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/ir-black.min.css" crossorigin>
<style>
:root {
--highlight-color: #202;
}
html {
scrollbar-face-color: #646464;
scrollbar-base-color: #646464;
scrollbar-3dlight-color: #646464;
scrollbar-highlight-color: #646464;
scrollbar-track-color: #000;
scrollbar-arrow-color: #000;
scrollbar-shadow-color: #646464;
scrollbar-dark-shadow-color: #646464;
}
::-webkit-scrollbar { width: 14px; height: 3px;}
::-webkit-scrollbar-button {
background-color: #000;
height: 3px;}
::-webkit-scrollbar-track {
background-color: #646464;}
::-webkit-scrollbar-track-piece { background-color: #000;}
::-webkit-scrollbar-thumb { height: 50px; background-color: #666; border-radius: 7px;}
::-webkit-scrollbar-corner { background-color: #646464;}
::-webkit-resizer { background-color: #666;}
.flex {
display: flex !important;
}
body {
line-height: 1.5em;
color: #fff;
background-color: #0f0f0f;
font: 14px/1.5 Helvetica, Arial, sans-serif;
margin: 0;
padding: 0;
}
#content {
padding: 20px;
}
#sidebar {
padding: 30px;
overflow: hidden;
}
#sidebar>*:last-child {
margin-bottom: 2cm;
}
.http-server-breadcrumbs {
font-size: 130%;
margin: 0 0 15px 0;
}
#footer {
font-size: .75em;
padding: 5px 30px;
border-top: 1px solid #fff;
text-align: right;
}
#footer p {
margin: 0 0 0 1em;
display: inline-block;
}
#footer p:last-child {
margin-right: 30px;
}
h1,
h2,
h3,
h4,
h5 {
font-weight: 300;
color: #fff;
}
h1 {
font-size: 2.5em;
line-height: 1.1em;
}
h2 {
font-size: 1.75em;
margin: 1em 0 .50em 0;
}
h3 {
font-size: 1.4em;
margin: 25px 0 10px 0;
}
h4 {
margin: 0;
font-size: 105%;
}
h1:target,
h2:target,
h3:target,
h4:target,
h5:target,
h6:target {
background: #000;
padding: 0.2em 0;
}
a {
color: #0a0;
text-decoration: none;
transition: color .3s ease-in-out;
}
a:hover {
color: #0c0;
}
.title code {
font-weight: bold;
}
h2[id^="header-"] {
margin-top: 2em;
}
.ident {
color: #ff00ca;
}
pre code {
background: transparent;
font-size: .8em;
line-height: 1.4em;
}
code {
background: rgba(255, 255, 255, 0.1);
padding: 1px 4px;
overflow-wrap: break-word;
}
h1 code {
background: transparent
}
pre {
background: transparent;
border: 0;
border-top: 1px solid #ccc;
border-bottom: 1px solid #ccc;
margin: 1em 0;
padding: 1ex;
}
#http-server-module-list {
display: flex;
flex-flow: column;
}
#http-server-module-list div {
display: flex;
}
#http-server-module-list dt {
min-width: 10%;
}
#http-server-module-list p {
margin-top: 0;
}
.toc ul,
#index {
list-style-type: none;
margin: 0;
padding: 0;
}
#index code {
background: transparent;
}
#index h3 {
border-bottom: 1px solid #ddd;
}
#index ul {
padding: 0;
}
#index h4 {
margin-top: .6em;
font-weight: bold;
}
/* Make TOC lists have 2+ columns when viewport is wide enough.
Assuming ~20-character identifiers and ~30% wide sidebar. */
@media (min-width: 200ex) {
#index .two-column {
column-count: 2
}
}
@media (min-width: 300ex) {
#index .two-column {
column-count: 3
}
}
dl {
margin-bottom: 2em;
}
dl dl:last-child {
margin-bottom: 4em;
}
dd {
margin: 0 0 1em 3em;
}
#header-classes+dl>dd {
margin-bottom: 3em;
}
dd dd {
margin-left: 2em;
}
dd p {
margin: 10px 0;
}
.name {
background: #000;
font-weight: bold;
font-size: .85em;
padding: 5px 10px;
display: inline-block;
min-width: 40%;
}
.name:hover {
background: #0b0b0b;
}
dt:target .name {
background: var(--highlight-color);
}
.name>span:first-child {
white-space: nowrap;
}
.name.class>span:nth-child(2) {
margin-left: .4em;
}
.inherited {
color: #999;
border-left: 5px solid #eee;
padding-left: 1em;
}
.inheritance em {
font-style: normal;
font-weight: bold;
}
.pydefname {
color: #f90;
}
/* Docstrings titles, e.g. in numpydoc format */
.desc h2 {
font-weight: 400;
font-size: 1.25em;
}
.desc h3 {
font-size: 1em;
}
.desc dt code {
background: inherit;
/* Don't grey-back parameters */
}
.source summary,
.git-link-div {
color: #666;
text-align: right;
font-weight: 400;
font-size: .8em;
text-transform: uppercase;
}
.source summary>* {
white-space: nowrap;
cursor: pointer;
}
.git-link {
color: inherit;
margin-left: 1em;
}
.source pre {
max-height: 500px;
overflow: auto;
margin: 0;
}
.source pre code {
font-size: 12px;
overflow: visible;
}
.hlist {
list-style: none;
}
.hlist li {
display: inline;
}
.hlist li:after {
content: ',\2002';
}
.hlist li:last-child:after {
content: none;
}
.hlist .hlist {
display: inline;
padding-left: 1em;
}
img {
max-width: 100%;
}
td {
padding: 0 .5em;
}
.admonition {
padding: .1em .5em;
margin-bottom: 1em;
}
.admonition-title {
font-weight: bold;
}
.admonition.note,
.admonition.info,
.admonition.important {
background: #00a;
}
.admonition.todo,
.admonition.versionadded,
.admonition.tip,
.admonition.hint {
background: #050;
}
.admonition.warning,
.admonition.versionchanged,
.admonition.deprecated {
background: #ec0;
}
.admonition.error,
.admonition.danger,
.admonition.caution {
background: #c20010;
}
p {
color: #fff;
}
</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>Euro-Truck-Simulator-2-Lane-Assist.main</code></h1>
</header>
<section id="section-intro">
<p>The main file that runs the programs loop.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#39;&#39;&#39;
The main file that runs the programs loop.
&#39;&#39;&#39;

# This section is for modules that I&#39;ve added later as they might 
# not have been installed yet

import os
try:
    import colorama
except:
    os.system(&#34;pip install colorama&#34;)
    import colorama

try:
    import matplotlib
except:
    os.system(&#34;pip install matplotlib&#34;)
    import matplotlib

try:
    import webview
except:
    os.system(&#34;pip install pywebview&#34;)
    import webview

try:
    import vdf
except:
    os.system(&#34;pip install vdf&#34;)
    import vdf

try:
    import deep_translator
except:
    os.system(&#34;pip install deep_translator&#34;)
    import deep_translator

try: 
    import babel
except:
    os.system(&#34;pip install babel&#34;)
    import babel

# Check that all requirments from requirments.txt are installed
import pkg_resources
import src.variables as variables # Stores all main variables for the program
with open(variables.PATH + r&#34;\requirements.txt&#34;) as f:
    requirements = f.read().splitlines()

installed = [pkg.key for pkg in pkg_resources.working_set]
requirementsset = set(requirements)
installedset = set(installed)
missing = requirementsset - installedset

if missing:
    for modules in missing:
        if &#34;deep_translator&#34; in modules:
            pass
        elif &#34;--upgrade --no-cache-dir gdown&#34; in modules:
            pass
        elif &#34;sv_ttk&#34; in modules:
            pass
        elif &#34;playsound2&#34; in modules:
            os.system(&#34;pip uninstall -y playsound&#34;)
            os.system(&#34;pip install playsound2&#34;)
        else:
            print(&#34;installing&#34; + &#34; &#34; + modules)
            os.system(&#34;pip install&#34; + &#34; &#34; + modules)
else:
    pass

import requests
def UpdateChecker():
    currentVer = variables.VERSION.split(&#34;.&#34;)
    url = &#34;https://raw.githubusercontent.com/Tumppi066/Euro-Truck-Simulator-2-Lane-Assist/main/version.txt&#34;
    try:
        remoteVer = requests.get(url).text.strip().split(&#34;.&#34;)
    except:
        print(&#34;Failed to check for updates&#34;)
        print(&#34;Please check your internet connection and try again later&#34;)
        return
    if currentVer[0] &lt; remoteVer[0]:
        update = True
    elif currentVer[1] &lt; remoteVer[1]:
        update = True
    elif currentVer[2] &lt; remoteVer[2]:
        update = True
    else:
        update = False
    
    devmode = settings.GetSettings(&#34;Dev&#34;, &#34;disable_warnings&#34;, False)
    if devmode == False:
        if update:
            changelog = variables.CHANGELOG
            from tkinter import messagebox
            if messagebox.askokcancel(&#34;Updater&#34;, (f&#34;We have detected an update, do you want to install it?\nCurrent - {&#39;.&#39;.join(currentVer)}\nUpdated - {&#39;.&#39;.join(remoteVer)}\n\nChangelog:\n{changelog}&#34;)):
                os.system(&#34;git stash&#34;)
                os.system(&#34;git pull&#34;)
                if messagebox.askyesno(&#34;Updater&#34;, (&#34;The update has been installed and the application needs to be restarted. Do you want to quit the app?&#34;)):
                    quit()
            else:
                pass

try:
    UpdateChecker()
except:
    pass

# Check tkinter tcl version
import tkinter as tk
from tkinter import messagebox
tcl = tk.Tcl()
acceptedVersions = [&#34;8.6.11&#34;, &#34;8.6.12&#34;, &#34;8.6.13&#34;]
version = str(tcl.call(&#39;info&#39;, &#39;patchlevel&#39;))
if version not in acceptedVersions:
    messagebox.showwarning(&#34;Warning&#34;, f&#34;Your tkinter version ({version} is not &gt;= 8.6.11) is too old. Windows scaling will be broken with this version.&#34;)
    print(f&#34;Your tkinter version ({version} is not &gt;= 8.6.11) is too old. Windows scaling will be broken with this version.&#34;)

# Load the UI framework
import src.mainUI as mainUI
import src.loading as loading # And then create a loading window


# Load the rest of the modules
import sys
import time
import json
from src.logger import print
import src.logger as logger
import traceback
import src.settings as settings
import src.translator as translator
import psutil
import cv2

logger.printDebug = settings.GetSettings(&#34;logger&#34;, &#34;debug&#34;)
if logger.printDebug == None:
    logger.printDebug = False
    settings.CreateSettings(&#34;logger&#34;, &#34;debug&#34;, False)
    

def GetEnabledPlugins():
    global enabledPlugins
    enabledPlugins = settings.GetSettings(&#34;Plugins&#34;, &#34;Enabled&#34;)
    if enabledPlugins == None:
        enabledPlugins = [&#34;&#34;]

def FindPlugins():
    global plugins
    global pluginObjects
    
    # Find plugins
    path = os.path.join(variables.PATH, &#34;plugins&#34;)
    plugins = []
    for file in os.listdir(path):
        if os.path.isdir(os.path.join(path, file)):
            # Check for main.py
            if &#34;main.py&#34; in os.listdir(os.path.join(path, file)):
                # Check for PluginInformation class
                try:
                    pluginPath = &#34;plugins.&#34; + file + &#34;.main&#34;
                    plugin = __import__(pluginPath, fromlist=[&#34;PluginInformation&#34;])
                    if plugin.PluginInfo.type == &#34;dynamic&#34;:
                        if plugin.PluginInfo.name in enabledPlugins:
                            plugins.append(plugin.PluginInfo)
                except Exception as ex:
                    print(str(ex.args) + f&#34; [{file}]&#34;)
                    pass

    pluginObjects = []
    for plugin in plugins:
        pluginObjects.append(__import__(&#34;plugins.&#34; + plugin.name + &#34;.main&#34;, fromlist=[&#34;plugin&#34;, &#34;UI&#34;, &#34;PluginInfo&#34;, &#34;onEnable&#34;]))
        pluginObjects[-1].onEnable()
        

def RunOnEnable():
    for plugin in pluginObjects:
        try:
            plugin.onEnable()
        except Exception as ex:
            print(ex.args)
            pass
        

def UpdatePlugins(dynamicOrder, data):
    for plugin in pluginObjects:
        try:
            if plugin.PluginInfo.dynamicOrder == dynamicOrder:
                startTime = time.time()
                data = plugin.plugin(data)
                endTime = time.time()
                if data == None:
                    print(f&#34;Plugin &#39;{plugin.PluginInfo.name}&#39; returned NoneType instead of a the data variable. Please make sure that you return the data variable.&#34;)
                else:
                    data[&#34;executionTimes&#34;][plugin.PluginInfo.name] = endTime - startTime
                        
        except Exception as ex:
            print(ex.args + f&#34;[{plugin.PluginInfo.name}]&#34;)
            pass
    return data


def InstallPlugins():
    global startInstall
    global loadingWindow
    
    list = settings.GetSettings(&#34;Plugins&#34;, &#34;Installed&#34;)
    if list == None:
        settings.CreateSettings(&#34;Plugins&#34;, &#34;Installed&#34;, [])
    
    # Find plugins
    path = os.path.join(variables.PATH, &#34;plugins&#34;)
    installers = []
    pluginNames = []
    for file in os.listdir(path):
        if os.path.isdir(os.path.join(path, file)):
            # Check for main.py
            if &#34;main.py&#34; in os.listdir(os.path.join(path, file)):
                # Check for PluginInformation class
                try:
                    # Get installers for plugins that are not installed
                    if file not in settings.GetSettings(&#34;Plugins&#34;, &#34;Installed&#34;):
                        pluginPath = &#34;plugins.&#34; + file + &#34;.install&#34;
                        try:
                            pluginNames.append(f&#34;{file}&#34;)
                            installers.append(__import__(pluginPath, fromlist=[&#34;install&#34;]))
                        except: # No installer
                            pass
                        
                    
                except Exception as ex:
                    print(ex.args)
                    pass
    
    if installers == []:
        return
    
    import tkinter as tk
    from tkinter import ttk
    
    try:
        loadingWindow.destroy()
    except:
        pass
    
    # Create a new tab for the installer
    installFrame = ttk.Frame(mainUI.pluginNotebook, width=600, height=520)
    installFrame.pack(anchor=tk.CENTER, expand=True, fill=tk.BOTH)
    mainUI.pluginNotebook.add(installFrame, text=&#34;Plugin Installer&#34;)
    mainUI.pluginNotebook.select(mainUI.pluginNotebook.tabs()[-1])
    
    ttk.Label(installFrame, text=&#34;The app has detected plugins that have not yet been installed.&#34;).pack()
    ttk.Label(installFrame, text=&#34;Please install them before continuing.&#34;).pack()
    ttk.Label(installFrame, text=&#34;&#34;).pack()
    ttk.Label(installFrame, text=&#34;WARNING: Make sure you trust the authors of the plugins.&#34;).pack()
    ttk.Label(installFrame, text=&#34;If you are at all skeptical then you can see the install script at&#34;).pack()
    ttk.Label(installFrame, text=&#34;app/plugins/&lt;plugin name&gt;/installer.py&#34;).pack()
    ttk.Label(installFrame, text=&#34;&#34;).pack()
    
    startInstall = False
    def SetInstallToTrue():
        global startInstall
        startInstall = True
    ttk.Button(installFrame, text=&#34;Install plugins&#34;, command=lambda: SetInstallToTrue()).pack()
    
    ttk.Label(installFrame, text=&#34;&#34;).pack()
    ttk.Label(installFrame, text=&#34;The following plugins require installation: &#34;).pack()
    # Make tk list object
    listbox = tk.Listbox(installFrame, width=75, height=30)
    listbox.pack()
    # Add the plugins there
    for plugin in pluginNames:
        listbox.insert(tk.END, plugin)
    # Center the listbox text
    listbox.config(justify=tk.CENTER)
    
    while not startInstall:
        mainUI.root.update()
    
    # Destroy all the widgets
    for child in installFrame.winfo_children():
        child.destroy()
        
    # Create the progress indicators
    ttk.Label(installFrame, text=&#34;\n\n\n\n\n\n\n&#34;).pack()
    currentPlugin = tk.StringVar(installFrame)
    currentPlugin.set(&#34;Installing plugins...&#34;)
    ttk.Label(installFrame, textvariable=currentPlugin).pack()
    bar = ttk.Progressbar(installFrame, orient=tk.HORIZONTAL, length=200, mode=&#39;determinate&#39;)
    bar.pack(pady=15)
    percentage = tk.StringVar(installFrame)
    ttk.Label(installFrame, textvariable=percentage).pack()
    ttk.Label(installFrame, text=&#34;&#34;).pack()
    ttk.Label(installFrame, text=&#34;This may take a while...&#34;).pack()
    ttk.Label(installFrame, text=&#34;For more information check the console.&#34;).pack()
    
    mainUI.root.update()
    
    loadingWindow = loading.LoadingWindow(&#34;Installing plugins...&#34;)
    
    index = 0
    for installer, name in zip(installers, pluginNames):
        print(f&#34;Installing &#39;{name}&#39;...&#34;)
        currentPlugin.set(f&#34;Installing &#39;{name}&#39;...&#34;)
        bar.config(value=(index / len(installers)) * 100)
        percentage.set(f&#34;{round((index / len(installers)) * 100)}%&#34;)
        mainUI.root.update()
        installer.install()
        settings.AddToList(&#34;Plugins&#34;, &#34;Installed&#34;, name.split(&#34; - &#34;)[0])
        index += 1
        loadingWindow.update(text=f&#34;Installing &#39;{name}&#39;...&#34;)
    
    # Destroy all the widgets
    for child in installFrame.winfo_children():
        child.destroy()
        
    ttk.Label(installFrame, text=&#34;\n\n\n\n\n\n\nYou should close this tab by middle clicking the name up top.&#34;).pack()
        
    # Remove the tab
    settings.RemoveFromList(&#34;Plugins&#34;, &#34;OpenTabs&#34;, &#34;Plugin Installer&#34;)
    variables.RELOAD = True
        

def CheckForONNXRuntimeChange():
    change = settings.GetSettings(&#34;SwitchLaneDetectionDevice&#34;, &#34;switchTo&#34;)
    if change != None:
        if change == &#34;GPU&#34;:
            loadingWindow.update(text=&#34;Uninstalling ONNX...&#34;)
            os.system(&#34;pip uninstall onnxruntime -y&#34;)
            loadingWindow.update(text=&#34;Installing ONNX GPU...&#34;)
            os.system(&#34;pip install onnxruntime-gpu&#34;)
        else:
            loadingWindow.update(text=&#34;Uninstalling ONNX GPU...&#34;)
            os.system(&#34;pip uninstall onnxruntime-gpu -y&#34;)
            loadingWindow.update(text=&#34;Installing ONNX...&#34;)
            os.system(&#34;pip install onnxruntime&#34;)
            
    settings.CreateSettings(&#34;SwitchLaneDetectionDevice&#34;, &#34;switchTo&#34;, None)

def CheckLastKnownVersion():
    lastVersion = settings.GetSettings(&#34;User Interface&#34;, &#34;version&#34;)
    if lastVersion == None:
        settings.UpdateSettings(&#34;User Interface&#34;, &#34;version&#34;, variables.VERSION)
        mainUI.switchSelectedPlugin(&#34;plugins.Changelog.main&#34;)
        return
    
    if lastVersion != variables.VERSION:
        settings.UpdateSettings(&#34;User Interface&#34;, &#34;version&#34;, variables.VERSION)
        mainUI.switchSelectedPlugin(&#34;plugins.Changelog.main&#34;)
        return
    
def CloseAllPlugins():
    for plugin in pluginObjects:
        plugin.onDisable()
        del plugin
        

timesLoaded = 0
def LoadApplication():
    global mainUI
    global uiUpdateRate
    global loadingWindow
    global timesLoaded

    loadingWindow = loading.LoadingWindow(&#34;Please wait initializing...&#34;)
    
    if timesLoaded &gt; 0:
        try:
            mainUI.DeleteRoot()
            del mainUI
            import src.mainUI as mainUI
            mainUI.CreateRoot()
        except:
            pass
        
    timesLoaded += 1
        

    CheckForONNXRuntimeChange()

    # Check for new plugin installs
    InstallPlugins()

    # Load all plugins 
    loadingWindow.update(text=&#34;Loading plugins...&#34;)
    GetEnabledPlugins()
    FindPlugins()
    loadingWindow.update(text=&#34;Initializing plugins...&#34;)
    RunOnEnable()

    logger.printDebug = settings.GetSettings(&#34;logger&#34;, &#34;debug&#34;)
    if logger.printDebug == None:
        logger.printDebug = False
        settings.CreateSettings(&#34;logger&#34;, &#34;debug&#34;, False)

    # We&#39;ve loaded all necessary modules
    showCopyrightInTitlebar = settings.GetSettings(&#34;User Interface&#34;, &#34;TitleCopyright&#34;)
    if showCopyrightInTitlebar == None:
        settings.CreateSettings(&#34;User Interface&#34;, &#34;TitleCopyright&#34;, True)
        showCopyrightInTitlebar = True
    
    mainUI.root.title((&#34;Lane Assist - ©Tumppi066 2023 - &#34; if showCopyrightInTitlebar else &#34;Lane Assist - &#34;) + open(settings.currentProfile, &#34;r&#34;).readline().replace(&#34;\n&#34;, &#34;&#34;))
    mainUI.root.update()
    mainUI.drawButtons()

    loadingWindow.destroy()
    del loadingWindow

    uiUpdateRate = settings.GetSettings(&#34;User Interface&#34;, &#34;updateRate&#34;)
    if uiUpdateRate == None: 
        uiUpdateRate = 0
        settings.CreateSettings(&#34;User Interface&#34;, &#34;updateRate&#34;, 0)

    CheckLastKnownVersion()

LoadApplication()

data = {}
uiFrameTimer = 0
if __name__ == &#34;__main__&#34;:
    while True:
        # Main Application Loop
        try:
            
            allStart = time.time()
            
            # Remove &#34;last&#34; from the data and set it as this frame&#39;s &#34;last&#34;
            try: 
                data.pop(&#34;last&#34;)
                data = {
                    &#34;last&#34;: data, 
                    &#34;executionTimes&#34;: {}
                }
            except Exception as ex:
                data = {
                    &#34;last&#34;: {},
                    &#34;executionTimes&#34;: {}
                }  
            
            if variables.RELOAD:
                print(&#34;Reloading application...&#34;)
                # Reset the open tabs
                settings.UpdateSettings(&#34;User Interface&#34;, &#34;OpenTabs&#34;, [])
                LoadApplication()
                variables.RELOAD = False
            
            # Enable / Disable the main loop
            if variables.ENABLELOOP == False:
                mainUI.update(data)
                allEnd = time.time()
                data[&#34;executionTimes&#34;][&#34;all&#34;] = allEnd - allStart
                try:
                    cv2.destroyWindow(&#34;Lane Assist&#34;)
                except:
                    pass
                continue
            
            if variables.UPDATEPLUGINS:
                GetEnabledPlugins()
                FindPlugins()
                variables.UPDATEPLUGINS = False
            
            data = UpdatePlugins(&#34;before image capture&#34;, data)
            data = UpdatePlugins(&#34;image capture&#34;, data)
            
            data = UpdatePlugins(&#34;before lane detection&#34;, data)
            data = UpdatePlugins(&#34;lane detection&#34;, data)
            
            data = UpdatePlugins(&#34;before controller&#34;, data)
            data = UpdatePlugins(&#34;controller&#34;, data)
            
            data = UpdatePlugins(&#34;before game&#34;, data)
            data = UpdatePlugins(&#34;game&#34;, data)
            
            data = UpdatePlugins(&#34;before UI&#34;, data)
            
            # Calculate the execution time of the UI
            start = time.time()
            uiFrameTimer += 1
            if uiFrameTimer &gt; uiUpdateRate:
                mainUI.update(data)
                uiFrameTimer = 0
            end = time.time()
            data[&#34;executionTimes&#34;][&#34;UI&#34;] = end - start
            
            data = UpdatePlugins(&#34;last&#34;, data)
            
            # And then the entire app
            allEnd = time.time()
            data[&#34;executionTimes&#34;][&#34;all&#34;] = allEnd - allStart

        
        except Exception as ex:
            if ex.args != (&#39;The main window has been closed.&#39;, &#39;If you closed the app this is normal.&#39;):
                import keyboard
                # Press the F1 key to pause the game
                keyboard.press_and_release(&#34;F1&#34;)
                
                from tkinter import messagebox
                import traceback
                exc = traceback.format_exc()
                traceback.print_exc()
                # Pack everything in ex.args into one string
                if not messagebox.askretrycancel(&#34;Error&#34;, translator.Translate(&#34;The application has encountered an error in the main thread!\nPlease either retry execution or close the application (cancel)!\n\n&#34;) + exc):
                    break
                else:
                    pass
            else:
                CloseAllPlugins()
                break</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="Euro-Truck-Simulator-2-Lane-Assist.main.CheckForONNXRuntimeChange"><code class="name flex">
<span>def <span class="ident">CheckForONNXRuntimeChange</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def CheckForONNXRuntimeChange():
    change = settings.GetSettings(&#34;SwitchLaneDetectionDevice&#34;, &#34;switchTo&#34;)
    if change != None:
        if change == &#34;GPU&#34;:
            loadingWindow.update(text=&#34;Uninstalling ONNX...&#34;)
            os.system(&#34;pip uninstall onnxruntime -y&#34;)
            loadingWindow.update(text=&#34;Installing ONNX GPU...&#34;)
            os.system(&#34;pip install onnxruntime-gpu&#34;)
        else:
            loadingWindow.update(text=&#34;Uninstalling ONNX GPU...&#34;)
            os.system(&#34;pip uninstall onnxruntime-gpu -y&#34;)
            loadingWindow.update(text=&#34;Installing ONNX...&#34;)
            os.system(&#34;pip install onnxruntime&#34;)
            
    settings.CreateSettings(&#34;SwitchLaneDetectionDevice&#34;, &#34;switchTo&#34;, None)</code></pre>
</details>
</dd>
<dt id="Euro-Truck-Simulator-2-Lane-Assist.main.CheckLastKnownVersion"><code class="name flex">
<span>def <span class="ident">CheckLastKnownVersion</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def CheckLastKnownVersion():
    lastVersion = settings.GetSettings(&#34;User Interface&#34;, &#34;version&#34;)
    if lastVersion == None:
        settings.UpdateSettings(&#34;User Interface&#34;, &#34;version&#34;, variables.VERSION)
        mainUI.switchSelectedPlugin(&#34;plugins.Changelog.main&#34;)
        return
    
    if lastVersion != variables.VERSION:
        settings.UpdateSettings(&#34;User Interface&#34;, &#34;version&#34;, variables.VERSION)
        mainUI.switchSelectedPlugin(&#34;plugins.Changelog.main&#34;)
        return</code></pre>
</details>
</dd>
<dt id="Euro-Truck-Simulator-2-Lane-Assist.main.CloseAllPlugins"><code class="name flex">
<span>def <span class="ident">CloseAllPlugins</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def CloseAllPlugins():
    for plugin in pluginObjects:
        plugin.onDisable()
        del plugin</code></pre>
</details>
</dd>
<dt id="Euro-Truck-Simulator-2-Lane-Assist.main.FindPlugins"><code class="name flex">
<span>def <span class="ident">FindPlugins</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def FindPlugins():
    global plugins
    global pluginObjects
    
    # Find plugins
    path = os.path.join(variables.PATH, &#34;plugins&#34;)
    plugins = []
    for file in os.listdir(path):
        if os.path.isdir(os.path.join(path, file)):
            # Check for main.py
            if &#34;main.py&#34; in os.listdir(os.path.join(path, file)):
                # Check for PluginInformation class
                try:
                    pluginPath = &#34;plugins.&#34; + file + &#34;.main&#34;
                    plugin = __import__(pluginPath, fromlist=[&#34;PluginInformation&#34;])
                    if plugin.PluginInfo.type == &#34;dynamic&#34;:
                        if plugin.PluginInfo.name in enabledPlugins:
                            plugins.append(plugin.PluginInfo)
                except Exception as ex:
                    print(str(ex.args) + f&#34; [{file}]&#34;)
                    pass

    pluginObjects = []
    for plugin in plugins:
        pluginObjects.append(__import__(&#34;plugins.&#34; + plugin.name + &#34;.main&#34;, fromlist=[&#34;plugin&#34;, &#34;UI&#34;, &#34;PluginInfo&#34;, &#34;onEnable&#34;]))
        pluginObjects[-1].onEnable()</code></pre>
</details>
</dd>
<dt id="Euro-Truck-Simulator-2-Lane-Assist.main.GetEnabledPlugins"><code class="name flex">
<span>def <span class="ident">GetEnabledPlugins</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def GetEnabledPlugins():
    global enabledPlugins
    enabledPlugins = settings.GetSettings(&#34;Plugins&#34;, &#34;Enabled&#34;)
    if enabledPlugins == None:
        enabledPlugins = [&#34;&#34;]</code></pre>
</details>
</dd>
<dt id="Euro-Truck-Simulator-2-Lane-Assist.main.InstallPlugins"><code class="name flex">
<span>def <span class="ident">InstallPlugins</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def InstallPlugins():
    global startInstall
    global loadingWindow
    
    list = settings.GetSettings(&#34;Plugins&#34;, &#34;Installed&#34;)
    if list == None:
        settings.CreateSettings(&#34;Plugins&#34;, &#34;Installed&#34;, [])
    
    # Find plugins
    path = os.path.join(variables.PATH, &#34;plugins&#34;)
    installers = []
    pluginNames = []
    for file in os.listdir(path):
        if os.path.isdir(os.path.join(path, file)):
            # Check for main.py
            if &#34;main.py&#34; in os.listdir(os.path.join(path, file)):
                # Check for PluginInformation class
                try:
                    # Get installers for plugins that are not installed
                    if file not in settings.GetSettings(&#34;Plugins&#34;, &#34;Installed&#34;):
                        pluginPath = &#34;plugins.&#34; + file + &#34;.install&#34;
                        try:
                            pluginNames.append(f&#34;{file}&#34;)
                            installers.append(__import__(pluginPath, fromlist=[&#34;install&#34;]))
                        except: # No installer
                            pass
                        
                    
                except Exception as ex:
                    print(ex.args)
                    pass
    
    if installers == []:
        return
    
    import tkinter as tk
    from tkinter import ttk
    
    try:
        loadingWindow.destroy()
    except:
        pass
    
    # Create a new tab for the installer
    installFrame = ttk.Frame(mainUI.pluginNotebook, width=600, height=520)
    installFrame.pack(anchor=tk.CENTER, expand=True, fill=tk.BOTH)
    mainUI.pluginNotebook.add(installFrame, text=&#34;Plugin Installer&#34;)
    mainUI.pluginNotebook.select(mainUI.pluginNotebook.tabs()[-1])
    
    ttk.Label(installFrame, text=&#34;The app has detected plugins that have not yet been installed.&#34;).pack()
    ttk.Label(installFrame, text=&#34;Please install them before continuing.&#34;).pack()
    ttk.Label(installFrame, text=&#34;&#34;).pack()
    ttk.Label(installFrame, text=&#34;WARNING: Make sure you trust the authors of the plugins.&#34;).pack()
    ttk.Label(installFrame, text=&#34;If you are at all skeptical then you can see the install script at&#34;).pack()
    ttk.Label(installFrame, text=&#34;app/plugins/&lt;plugin name&gt;/installer.py&#34;).pack()
    ttk.Label(installFrame, text=&#34;&#34;).pack()
    
    startInstall = False
    def SetInstallToTrue():
        global startInstall
        startInstall = True
    ttk.Button(installFrame, text=&#34;Install plugins&#34;, command=lambda: SetInstallToTrue()).pack()
    
    ttk.Label(installFrame, text=&#34;&#34;).pack()
    ttk.Label(installFrame, text=&#34;The following plugins require installation: &#34;).pack()
    # Make tk list object
    listbox = tk.Listbox(installFrame, width=75, height=30)
    listbox.pack()
    # Add the plugins there
    for plugin in pluginNames:
        listbox.insert(tk.END, plugin)
    # Center the listbox text
    listbox.config(justify=tk.CENTER)
    
    while not startInstall:
        mainUI.root.update()
    
    # Destroy all the widgets
    for child in installFrame.winfo_children():
        child.destroy()
        
    # Create the progress indicators
    ttk.Label(installFrame, text=&#34;\n\n\n\n\n\n\n&#34;).pack()
    currentPlugin = tk.StringVar(installFrame)
    currentPlugin.set(&#34;Installing plugins...&#34;)
    ttk.Label(installFrame, textvariable=currentPlugin).pack()
    bar = ttk.Progressbar(installFrame, orient=tk.HORIZONTAL, length=200, mode=&#39;determinate&#39;)
    bar.pack(pady=15)
    percentage = tk.StringVar(installFrame)
    ttk.Label(installFrame, textvariable=percentage).pack()
    ttk.Label(installFrame, text=&#34;&#34;).pack()
    ttk.Label(installFrame, text=&#34;This may take a while...&#34;).pack()
    ttk.Label(installFrame, text=&#34;For more information check the console.&#34;).pack()
    
    mainUI.root.update()
    
    loadingWindow = loading.LoadingWindow(&#34;Installing plugins...&#34;)
    
    index = 0
    for installer, name in zip(installers, pluginNames):
        print(f&#34;Installing &#39;{name}&#39;...&#34;)
        currentPlugin.set(f&#34;Installing &#39;{name}&#39;...&#34;)
        bar.config(value=(index / len(installers)) * 100)
        percentage.set(f&#34;{round((index / len(installers)) * 100)}%&#34;)
        mainUI.root.update()
        installer.install()
        settings.AddToList(&#34;Plugins&#34;, &#34;Installed&#34;, name.split(&#34; - &#34;)[0])
        index += 1
        loadingWindow.update(text=f&#34;Installing &#39;{name}&#39;...&#34;)
    
    # Destroy all the widgets
    for child in installFrame.winfo_children():
        child.destroy()
        
    ttk.Label(installFrame, text=&#34;\n\n\n\n\n\n\nYou should close this tab by middle clicking the name up top.&#34;).pack()
        
    # Remove the tab
    settings.RemoveFromList(&#34;Plugins&#34;, &#34;OpenTabs&#34;, &#34;Plugin Installer&#34;)
    variables.RELOAD = True</code></pre>
</details>
</dd>
<dt id="Euro-Truck-Simulator-2-Lane-Assist.main.LoadApplication"><code class="name flex">
<span>def <span class="ident">LoadApplication</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def LoadApplication():
    global mainUI
    global uiUpdateRate
    global loadingWindow
    global timesLoaded

    loadingWindow = loading.LoadingWindow(&#34;Please wait initializing...&#34;)
    
    if timesLoaded &gt; 0:
        try:
            mainUI.DeleteRoot()
            del mainUI
            import src.mainUI as mainUI
            mainUI.CreateRoot()
        except:
            pass
        
    timesLoaded += 1
        

    CheckForONNXRuntimeChange()

    # Check for new plugin installs
    InstallPlugins()

    # Load all plugins 
    loadingWindow.update(text=&#34;Loading plugins...&#34;)
    GetEnabledPlugins()
    FindPlugins()
    loadingWindow.update(text=&#34;Initializing plugins...&#34;)
    RunOnEnable()

    logger.printDebug = settings.GetSettings(&#34;logger&#34;, &#34;debug&#34;)
    if logger.printDebug == None:
        logger.printDebug = False
        settings.CreateSettings(&#34;logger&#34;, &#34;debug&#34;, False)

    # We&#39;ve loaded all necessary modules
    showCopyrightInTitlebar = settings.GetSettings(&#34;User Interface&#34;, &#34;TitleCopyright&#34;)
    if showCopyrightInTitlebar == None:
        settings.CreateSettings(&#34;User Interface&#34;, &#34;TitleCopyright&#34;, True)
        showCopyrightInTitlebar = True
    
    mainUI.root.title((&#34;Lane Assist - ©Tumppi066 2023 - &#34; if showCopyrightInTitlebar else &#34;Lane Assist - &#34;) + open(settings.currentProfile, &#34;r&#34;).readline().replace(&#34;\n&#34;, &#34;&#34;))
    mainUI.root.update()
    mainUI.drawButtons()

    loadingWindow.destroy()
    del loadingWindow

    uiUpdateRate = settings.GetSettings(&#34;User Interface&#34;, &#34;updateRate&#34;)
    if uiUpdateRate == None: 
        uiUpdateRate = 0
        settings.CreateSettings(&#34;User Interface&#34;, &#34;updateRate&#34;, 0)

    CheckLastKnownVersion()</code></pre>
</details>
</dd>
<dt id="Euro-Truck-Simulator-2-Lane-Assist.main.RunOnEnable"><code class="name flex">
<span>def <span class="ident">RunOnEnable</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def RunOnEnable():
    for plugin in pluginObjects:
        try:
            plugin.onEnable()
        except Exception as ex:
            print(ex.args)
            pass</code></pre>
</details>
</dd>
<dt id="Euro-Truck-Simulator-2-Lane-Assist.main.UpdateChecker"><code class="name flex">
<span>def <span class="ident">UpdateChecker</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def UpdateChecker():
    currentVer = variables.VERSION.split(&#34;.&#34;)
    url = &#34;https://raw.githubusercontent.com/Tumppi066/Euro-Truck-Simulator-2-Lane-Assist/main/version.txt&#34;
    try:
        remoteVer = requests.get(url).text.strip().split(&#34;.&#34;)
    except:
        print(&#34;Failed to check for updates&#34;)
        print(&#34;Please check your internet connection and try again later&#34;)
        return
    if currentVer[0] &lt; remoteVer[0]:
        update = True
    elif currentVer[1] &lt; remoteVer[1]:
        update = True
    elif currentVer[2] &lt; remoteVer[2]:
        update = True
    else:
        update = False
    
    devmode = settings.GetSettings(&#34;Dev&#34;, &#34;disable_warnings&#34;, False)
    if devmode == False:
        if update:
            changelog = variables.CHANGELOG
            from tkinter import messagebox
            if messagebox.askokcancel(&#34;Updater&#34;, (f&#34;We have detected an update, do you want to install it?\nCurrent - {&#39;.&#39;.join(currentVer)}\nUpdated - {&#39;.&#39;.join(remoteVer)}\n\nChangelog:\n{changelog}&#34;)):
                os.system(&#34;git stash&#34;)
                os.system(&#34;git pull&#34;)
                if messagebox.askyesno(&#34;Updater&#34;, (&#34;The update has been installed and the application needs to be restarted. Do you want to quit the app?&#34;)):
                    quit()
            else:
                pass</code></pre>
</details>
</dd>
<dt id="Euro-Truck-Simulator-2-Lane-Assist.main.UpdatePlugins"><code class="name flex">
<span>def <span class="ident">UpdatePlugins</span></span>(<span>dynamicOrder, data)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def UpdatePlugins(dynamicOrder, data):
    for plugin in pluginObjects:
        try:
            if plugin.PluginInfo.dynamicOrder == dynamicOrder:
                startTime = time.time()
                data = plugin.plugin(data)
                endTime = time.time()
                if data == None:
                    print(f&#34;Plugin &#39;{plugin.PluginInfo.name}&#39; returned NoneType instead of a the data variable. Please make sure that you return the data variable.&#34;)
                else:
                    data[&#34;executionTimes&#34;][plugin.PluginInfo.name] = endTime - startTime
                        
        except Exception as ex:
            print(ex.args + f&#34;[{plugin.PluginInfo.name}]&#34;)
            pass
    return data</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist" href="index.html">Euro-Truck-Simulator-2-Lane-Assist</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist.main.CheckForONNXRuntimeChange" href="#Euro-Truck-Simulator-2-Lane-Assist.main.CheckForONNXRuntimeChange">CheckForONNXRuntimeChange</a></code></li>
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist.main.CheckLastKnownVersion" href="#Euro-Truck-Simulator-2-Lane-Assist.main.CheckLastKnownVersion">CheckLastKnownVersion</a></code></li>
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist.main.CloseAllPlugins" href="#Euro-Truck-Simulator-2-Lane-Assist.main.CloseAllPlugins">CloseAllPlugins</a></code></li>
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist.main.FindPlugins" href="#Euro-Truck-Simulator-2-Lane-Assist.main.FindPlugins">FindPlugins</a></code></li>
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist.main.GetEnabledPlugins" href="#Euro-Truck-Simulator-2-Lane-Assist.main.GetEnabledPlugins">GetEnabledPlugins</a></code></li>
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist.main.InstallPlugins" href="#Euro-Truck-Simulator-2-Lane-Assist.main.InstallPlugins">InstallPlugins</a></code></li>
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist.main.LoadApplication" href="#Euro-Truck-Simulator-2-Lane-Assist.main.LoadApplication">LoadApplication</a></code></li>
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist.main.RunOnEnable" href="#Euro-Truck-Simulator-2-Lane-Assist.main.RunOnEnable">RunOnEnable</a></code></li>
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist.main.UpdateChecker" href="#Euro-Truck-Simulator-2-Lane-Assist.main.UpdateChecker">UpdateChecker</a></code></li>
<li><code><a title="Euro-Truck-Simulator-2-Lane-Assist.main.UpdatePlugins" href="#Euro-Truck-Simulator-2-Lane-Assist.main.UpdatePlugins">UpdatePlugins</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>